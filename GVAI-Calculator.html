<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GVAI Vulnerability Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main Application Container -->
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-lg space-y-6">

        <!-- Title and Description -->
        <h1 class="text-3xl font-bold text-center text-gray-800">
            Geospatial Vulnerability Assessment Index (GVAI) Calculator
        </h1>
        <p class="text-center text-gray-600">
            Simulate the proprietary scoring formula by entering your feature values below.
        </p>
        <hr class="border-gray-200">

        <!-- Input Form -->
        <div class="space-y-4">
            <!-- Zone Type Dropdown -->
            <div>
                <label for="zoneType" class="block text-sm font-medium text-gray-700 mb-1">Select Zone Type</label>
                <select id="zoneType" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    <option value="urban">Urban</option>
                    <option value="agricultural">Agricultural</option>
                    <option value="industrial">Industrial</option>
                    <option value="forest">Forest</option>
                    <option value="default">Default</option>
                </select>
            </div>
            
            <!-- NDVI Loss Rate Input -->
            <div>
                <label for="ndviLossRate" class="block text-sm font-medium text-gray-700 mb-1">
                    NDVI Loss Rate (e.g., 0.25)
                </label>
                <input type="number" id="ndviLossRate" value="0.5" step="0.01" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
            </div>

            <!-- Tornado Frequency Input -->
            <div>
                <label for="stormFrequency" class="block text-sm font-medium text-gray-700 mb-1">
                    Historical Tornado Frequency (e.g., 3)
                </label>
                <input type="number" id="stormFrequency" value="2" step="1" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
            </div>

            <!-- Infrastructure Count Input -->
            <div>
                <label for="infraCount" class="block text-sm font-medium text-gray-700 mb-1">
                    Nearby Critical Infrastructure Count (e.g., 5)
                </label>
                <input type="number" id="infraCount" value="3" step="1" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
            </div>

            <!-- Infrastructure Exposed Checkbox -->
            <div class="flex items-center">
                <input type="checkbox" id="infraExposed" checked class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                <label for="infraExposed" class="ml-2 block text-sm font-medium text-gray-700">
                    Zone has direct Infrastructure Exposure
                </label>
            </div>
        </div>

        <!-- Calculate Button -->
        <button onclick="calculateGVAI()" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out">
            Calculate Vulnerability Score
        </button>
        
        <hr class="border-gray-200">

        <!-- Results Display -->
        <div id="results" class="space-y-4">
            <h2 class="text-xl font-bold text-center text-gray-800">Calculation Results</h2>
            <p id="vulnerabilityScore" class="text-lg text-center font-medium text-gray-700">Vulnerability Score: <span class="text-blue-600">--</span></p>
            <p id="normalizedScore" class="text-lg text-center font-medium text-gray-700">Normalized Score: <span class="text-blue-600">--</span></p>
            <p id="errorMessage" class="text-center text-red-500 hidden">Please enter valid numbers for all inputs.</p>
        </div>

    </div>

    <script>
        // Get references to all input elements and results display
        const ndviLossInput = document.getElementById('ndviLossRate');
        const stormFrequencyInput = document.getElementById('stormFrequency');
        const infraCountInput = document.getElementById('infraCount');
        const infraExposedCheckbox = document.getElementById('infraExposed');
        const zoneTypeSelect = document.getElementById('zoneType');
        const vulnerabilityScoreElem = document.getElementById('vulnerabilityScore').querySelector('span');
        const normalizedScoreElem = document.getElementById('normalizedScore').querySelector('span');
        const errorMessageElem = document.getElementById('errorMessage');

        // Zone-type specific weights as defined in the specification
        const ZONE_WEIGHTS = {
            "urban":      { "infra_mult": 0.6, "exposed_boost": 2.0 },
            "agricultural": { "infra_mult": 0.4, "exposed_boost": 1.2 },
            "industrial": { "infra_mult": 0.5, "exposed_boost": 1.8 },
            "forest":     { "infra_mult": 0.3, "exposed_boost": 1.0 },
            "default":    { "infra_mult": 0.5, "exposed_boost": 1.5 }
        };

        /**
         * Calculates the Infrastructure Proximity Score based on user inputs and zone type.
         * @param {number} infraCount - The number of nearby infrastructure points.
         * @param {boolean} infraExposed - True if the zone is directly exposed, false otherwise.
         * @param {string} zoneType - The type of geographic zone (e.g., 'urban', 'forest').
         * @returns {number} The calculated infrastructure proximity score.
         */
        function computeProximityScore(infraCount, infraExposed, zoneType) {
            const weights = ZONE_WEIGHTS[zoneType] || ZONE_WEIGHTS["default"];
            const exposedBoost = infraExposed ? weights.exposed_boost : 0;
            return (infraCount * weights.infra_mult) + exposedBoost;
        }

        /**
         * Calculates the Geospatial Vulnerability Assessment Index (GVAI) score.
         */
        function calculateGVAI() {
            // Get values from the UI, converting to numbers
            const ndviLossRate = parseFloat(ndviLossInput.value);
            const stormFrequency = parseFloat(stormFrequencyInput.value);
            const infraCount = parseInt(infraCountInput.value, 10);
            const infraExposed = infraExposedCheckbox.checked;
            const zoneType = zoneTypeSelect.value;
            
            // Basic input validation
            if (isNaN(ndviLossRate) || isNaN(stormFrequency) || isNaN(infraCount) || ndviLossRate < 0 || stormFrequency < 0 || infraCount < 0) {
                errorMessageElem.classList.remove('hidden');
                return;
            }
            errorMessageElem.classList.add('hidden');

            // Apply log transformations as per the specification
            const logStormFreq = Math.log(stormFrequency + 1);
            const logNdviLoss = Math.log(ndviLossRate + 1);

            // Compute the infrastructure proximity score
            const infraProximityScore = computeProximityScore(infraCount, infraExposed, zoneType);

            // Calculate the composite vulnerability score
            const vulnerabilityScore = (logStormFreq * infraProximityScore) / (logNdviLoss + 0.01);
            
            // Handle edge cases (e.g., division by zero)
            const finalScore = isNaN(vulnerabilityScore) || !isFinite(vulnerabilityScore) ? 0 : vulnerabilityScore;

            // Simple normalization (Note: In a real app, min/max would come from a full dataset)
            // For this simulation, we can use a hard-coded range or a simple scaling.
            // Let's assume a max score for demonstration purposes to show a normalized value.
            const assumedMaxScore = 50; 
            const normalizedScore = Math.min(finalScore / assumedMaxScore, 1).toFixed(3);

            // Update the UI with the results
            vulnerabilityScoreElem.textContent = finalScore.toFixed(3);
            normalizedScoreElem.textContent = normalizedScore;
        }

        // Run calculation on initial load
        document.addEventListener('DOMContentLoaded', calculateGVAI);
    </script>
</body>
</html>
